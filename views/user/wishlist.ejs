<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist - STYLE AND VIBE</title>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
    rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    
    <style>
        .wishlist-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .wishlist-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .wishlist-table th, .wishlist-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .wishlist-table th {
            background-color: #f9f9f9;
            font-weight: 600;
        }
        .wishlist-table img {
            max-width: 100px;
            height: auto;
            border-radius: 5px;
        }
        .product-thumbnail {
            width: 120px;
        }
        .product-name {
            width: 40%;
        }
        .product-name h5 {
            margin-bottom: 5px;
            font-weight: 600;
        }
        .product-name p {
            color: #666;
            margin-bottom: 0;
        }
        .price {
            width: 20%;
            font-weight: 600;
        }
        .price .text-muted {
            font-weight: normal;
            margin-left: 5px;
            font-size: 0.9em;
        }
        .action {
            width: 20%;
        }
        .button-group {
            display: flex;
            gap: 10px;
        }
        .add-to-cart-btn, .remove-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s, transform 0.2s;
        }
        .add-to-cart-btn {
            background-color: #46698f;
            color: white;
        }
        .remove-btn {
            background-color: #ff6b6b;
            color: white;
        }
        .add-to-cart-btn:hover, .remove-btn:hover {
            transform: scale(1.05);
        }
        .empty-wishlist {
            text-align: center;
            padding: 50px 0;
        }
        .empty-wishlist h3 {
            margin-bottom: 15px;
            color: #333;
        }
        .empty-wishlist p {
            color: #666;
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 20px;
            background-color: #46698f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #385676;
        }
        .wishlist-title {
            margin-bottom: 30px;
            font-weight: 700;
            color: #333;
        }
    </style>
</head>
<body>
    <%- include("../../views/partial/user/header") %>

    <div class="wishlist-container">
        <h2 class="wishlist-title">My Wishlist</h2>
        
        <% if(wishlist && wishlist.length > 0) { %>
            <table class="wishlist-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let i = 0; i < wishlist.length; i++) { %>
                        <tr>
                            <td class="product-thumbnail">
                                <a href="/productDetails?id=<%= wishlist[i].productId._id %>">
                                    <img src="/uploads/re-image/<%= wishlist[i].productId.productImage[0] %>" alt="<%= wishlist[i].productName %>" />
                                </a>
                            </td>
                            <td class="product-name">
                                <h5><a href="/productDetails?id=<%= wishlist[i].productId._id %>"><%= wishlist[i].productId.productName %></a></h5>
                                <p>Brand: <%= wishlist[i].productId.brand %></p>
                            </td>
                            <td class="price">
                                ₹<%= wishlist[i].productId.salesPrice.toLocaleString('en-IN') %>
                                <span class="text-muted"><strike>₹<%= wishlist[i].productId.regularPrice.toLocaleString('en-IN') %></strike></span>
                            </td>
                            <td class="action">
                                <div class="button-group">
                                    <button class="add-to-cart-btn" onclick="addToCart('<%= wishlist[i].productId._id %>')">Add to Cart</button>
                                    <button class="remove-btn" onclick="removeFromWishlist('<%= wishlist[i].productId._id %>')">Remove</button>
                                </div>
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        <% } else { %>
            <div class="empty-wishlist">
                <h3>Your wishlist is empty</h3>
                <p>Add items to your wishlist to save them for later!</p>
                <a href="/shop" class="btn">Continue Shopping</a>
            </div>
        <% } %>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        function removeFromWishlist(productId) {
             $.ajax({
                url: '/removeFromWishlist',
                method: 'POST',
                data: { productId: productId },
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            title: "Removed from wishlist",
                            text: response.message,
                            icon: 'success',
                            timer: 2000
                        }).then(() => {
                    location.reload();
                });
            } else {
                Swal.fire({
                    title: "Error",
                    text: response.message,
                    icon: 'error',
                    timer: 2000
                });
            }
        },
        error: function(xhr, status, error) {
            Swal.fire({
                title: "Error",
                text: "There was an error removing item from wishlist",
                icon: 'error',
                timer: 2000
            });
        }
    });
}

function addToCart(productId) {
    $.ajax({
        url: '/addToCart',
        method: 'POST',
        data: { productId: productId },
        success: function(response) {
            if (response.success) {
                Swal.fire({
                    title: "Added to cart",
                    text: response.message,
                    icon: 'success',
                    timer: 2000
                }).then(() => {
                    // Reload the page to update wishlist display
                    location.reload();
                });
            } else {
                Swal.fire({
                    title: "Note",
                    text: response.message || "Could not add to cart",
                    icon: 'info',
                    timer: 2000
                });
            }
        },
        error: function(xhr, status, error) {
            Swal.fire({
                title: "Error",
                text: "There was an error adding item to cart",
                icon: 'error',
                timer: 2000
            });
        }
    });
}
    </script>

</body>
</html>